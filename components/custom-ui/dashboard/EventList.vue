<script lang="ts" setup>
import {ScrollArea} from '@/components/ui/scroll-area'
import {cn} from '@/utils/shadcn'
import {Badge} from '@/components/ui/badge'
import {formatDate} from '~/composables/utils'
import {formatDistanceToNow} from "date-fns";

/* ----- Component Properties ----- */
interface EventListProps {
  items: BaseTx[] //Mail[]
}

defineProps<EventListProps>()
const selectedEvent = defineModel<string>('selectedEvent', {required: false})
/* ----- End Component Properties ----- */
</script>

<template>
  <ScrollArea class="h-full flex">
    <div class="flex-1 flex flex-col gap-2 p-4 pt-0">
      <TransitionGroup name="list" appear>
        <button v-for="item of items"
                :key="item.event_id"
                :class="cn('flex flex-col items-start gap-2 rounded-lg border p-3 text-left text-sm transition-all hover:bg-accent',
                selectedEvent === item.event_id && 'bg-muted',)"
                @click="selectedEvent = item.event_id">
          <div class="flex w-full flex-col gap-1">
            <div class="flex items-center">
              <div class="flex items-center gap-2">
                <div class="font-semibold">
                  {{ item.type }}
                  <!--{{ item.name }}-->
                </div>
                <!--
                <span v-if="!item.read" class="flex h-2 w-2 rounded-full bg-blue-600"/>
                -->
              </div>
              <div :class="cn('ml-auto text-xs', selectedEvent === item.event_id ? 'text-foreground' : 'text-muted-foreground',)">
                <TooltipProvider :delay-duration="100">
                  <Tooltip>
                    <TooltipTrigger>
                      {{ formatDistanceToNow(new Date(decodeTime(item.event_id))) + ' ago' }}
                    </TooltipTrigger>
                    <TooltipContent>
                      <p>{{ formatDate(new Date(decodeTime(item.event_id)).toString()) }}</p>
                    </TooltipContent>
                  </Tooltip>
                </TooltipProvider>
              </div>
            </div>

            <div class="text-xs font-medium">
              {{ item.event_id }}
            </div>
          </div>
          <div class="line-clamp-2 text-xs text-muted-foreground">
            Here can be a short summary for: {{ item.type }}
            <!-- {{ item.message.substring(0, 300) }} -->
            <!--{{ item.text.substring(0, 300) }}-->
          </div>
          <div class="flex items-center gap-2">
            <Badge v-if="item.requester.Unregistered" variant="outline">Unregistered</Badge>
            <Badge v-if="item.requester.User" variant="secondary">User</Badge>
            <Badge v-if="item.requester.User?.impersonated_by" variant="default">Impersonated</Badge>
            <Badge v-if="item.requester.User?.auth_method.Oidc" variant="default">OIDC</Badge>
            <Badge v-if="item.requester.User?.auth_method.Aruna" variant="default">Aruna</Badge>
          </div>
        </button>
      </TransitionGroup>
    </div>
  </ScrollArea>
</template>

<style scoped>
.list-move,
.list-enter-active,
.list-leave-active {
  transition: all 0.5s ease;
}

.list-enter-from,
.list-leave-to {
  opacity: 0;
  transform: translateY(15px);
}

.list-leave-active {
  position: absolute;
}
</style>